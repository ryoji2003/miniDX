<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒã‚¹ã‚¿è¨­å®š - ã‚·ãƒ•ãƒˆã‚¢ãƒ—ãƒª</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h2 { border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        
        /* ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .form-group { margin-bottom: 15px; }
        label { display: inline-block; width: 150px; }
        input { padding: 5px; }
        button { padding: 5px 15px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #0056b3; }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ è¨­å®šç”»é¢</h1>

        <section>
            <h2>ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²</h2>
            <div class="form-group">
                <label>åå‰:</label>
                <input type="text" id="staffName" placeholder="ä¾‹: å±±ç”° èŠ±å­">
            </div>
            <div class="form-group">
                <label>æœˆé–“å‹¤å‹™ä¸Šé™:</label>
                <input type="number" id="staffLimit" value="20">
            </div>
            <button onclick="registerStaff()">ç™»éŒ²ã™ã‚‹</button>
        </section>

        <section>
            <h2>ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§</h2>
            <table id="staffTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>åå‰</th>
                        <th>å‹¤å‹™ä¸Šé™</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </section>
    </div>

    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¸€è¦§ã‚’å–å¾—
        window.onload = function() {
            fetchStaffList();
        };

        // --- 1. ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ã‚’å–å¾—ã—ã¦è¡¨ç¤º ---
        async function fetchStaffList() {
            try {
                // APIã‚’å‘¼ã³å‡ºã™
                const response = await fetch("/api/staff");
                const staffList = await response.json();

                // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¦æ›¸ãç›´ã™
                const tbody = document.querySelector("#staffTable tbody");
                tbody.innerHTML = "";

                staffList.forEach(staff => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${staff.id}</td>
                        <td>${staff.name}</td>
                        <td>${staff.work_limit}æ—¥</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error("ã‚¨ãƒ©ãƒ¼:", error);
                alert("ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
            }
        }

        // --- 2. ã‚¹ã‚¿ãƒƒãƒ•ã‚’æ–°è¦ç™»éŒ² ---
        async function registerStaff() {
            const name = document.getElementById("staffName").value;
            const limit = document.getElementById("staffLimit").value;

            if (!name) {
                alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
                return;
            }

            try {
                // APIã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ (POST)
                const response = await fetch("/api/staff", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        name: name,
                        work_limit: parseInt(limit)
                    })
                });

                if (response.ok) {
                    alert("ç™»éŒ²ã—ã¾ã—ãŸï¼");
                    document.getElementById("staffName").value = ""; // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
                    fetchStaffList(); // ä¸€è¦§ã‚’å†å–å¾—
                } else {
                    alert("ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ");
                }
            } catch (error) {
                console.error("ã‚¨ãƒ©ãƒ¼:", error);
            }
        }
    </script>
</body>
</html>